import{C as P,r as y,o as U,w as Z,c as q,a as i,b as o,d,u as G,Z as I,e as Y,f as e,t as f,i as A,F as k,l as L,n as v,g as T,H as J,h as Q,m as X,v as ee,a9 as M}from"./app-CT_6SLLp.js";import{_ as V}from"./Card-BLrSWe1I.js";import{_ as te}from"./NavLink-CJt-5OEo.js";import{_ as se}from"./ScheduleTabs-z91zdUdJ.js";import{_ as b}from"./FlexButton-BfzYclv0.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"py-8"},oe={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ne={class:"flex justify-between items-center mb-6"},re={class:"font-semibold text-lg"},ie={class:"px-6 pb-6"},de={class:"w-full border-separate border-spacing-y-2"},ue={class:"py-4 px-4 text-lg font-bold text-gray-700 w-40 align-top"},ce={class:"flex flex-col"},fe={class:"text-xs font-semibold text-gray-400 uppercase"},me={class:"text-2xl font-extrabold"},pe=["onClick"],ye={key:0},be={key:1},ve={class:"flex justify-end mt-8 space-x-4"},ge={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},xe={class:"bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md relative animate-fadeIn"},he=["disabled"],_e={class:"text-2xl font-bold mb-6 text-gray-800 text-center"},we={class:"text-base font-medium text-gray-500"},Ye={key:0,class:"flex flex-col items-center justify-center py-8"},ke={key:1,class:"mb-6"},Me=["disabled"],De=["value"],Se={__name:"AdminSchedule",props:{staffList:{type:Array,default:()=>[]},leaveList:{type:Array,default:()=>[]}},setup($){const g=$;console.log("staffList:",g.staffList);const D=["Morning","Night"],N=P(),S=N.startOf("week").add(1,"day"),l=y(N.isBefore(S,"day")?S:S.add(7,"day")),x=y(null),h=y(null),r=y(!1),c=y({}),_=y(""),m=y(!1);async function p(){const a=l.value.format("YYYY-MM-DD"),{data:t}=await M.get("/schedule/week",{params:{week_start:a}});c.value=t.assignments||{},m.value=t.submitted||!1}U(p),Z(l,p);const B=q(()=>Array.from({length:7},(a,t)=>l.value.add(t,"day")));function W(a,t){x.value=a,h.value=t,c.value[a.format("YYYY-MM-DD")]||(c.value[a.format("YYYY-MM-DD")]=[null,null]),_.value=c.value[a.format("YYYY-MM-DD")][t]||""}function C(){r.value||(x.value=null,h.value=null)}async function F(){r.value=!0,await new Promise(u=>setTimeout(u,1e3));const a=_.value,t=x.value.format("YYYY-MM-DD"),s=l.value.format("YYYY-MM-DD");if(g.leaveList&&g.leaveList.some(u=>u.employee_id==a&&u.date===t)){r.value=!1,alert("This staff is on leave for the selected day. Please pick another staff.");return}if((c.value[t]||[null,null]).includes(a)){r.value=!1,alert("This staff is already assigned to another shift on this day. Please pick another staff.");return}let n=0;for(const[u,R]of Object.entries(c.value))u>=s&&u<=P(s).add(6,"day").format("YYYY-MM-DD")&&R.includes(a)&&n++;if(n>=6){r.value=!1,alert("This staff is already assigned to 6 days in this week. Please pick another staff.");return}await M.post("/schedule/assign",{employee_id:a,shift_type:D[h.value].toLowerCase(),week_start:s,day:t}),await p(),r.value=!1,C()}function z(){l.value=l.value.subtract(1,"week"),p()}function H(){l.value=l.value.add(1,"week"),p()}async function O(){await M.post("/schedule/submit-week",{week_start:l.value.format("YYYY-MM-DD")}),await p(),alert("Weekly schedule submitted successfully!"),l.value=l.value.add(7,"day")}function E(a,t){var n;const s=(n=c.value[a.format("YYYY-MM-DD")])==null?void 0:n[t],w=g.staffList.find(u=>u.id==s);return w?w.name:""}function j(a,t){var s;return!!((s=c.value[a.format("YYYY-MM-DD")])!=null&&s[t])}async function K(){confirm("Are you sure you want to reset all assignments for this week?")&&(await M.post("/schedule/reset",{week_start:l.value.format("YYYY-MM-DD")}),c.value={},await p())}return(a,t)=>(o(),i(k,null,[d(G(I),{title:"Weekly Schedule"}),d(te,null,{tabs:Y(()=>[d(se)]),default:Y(()=>[e("div",le,[e("div",oe,[d(V,null,{default:Y(()=>[e("div",ne,[d(b,{text:"Previous",onClick:z}),e("span",re,f(l.value.format("MMM D, YYYY"))+" - "+f(l.value.add(6,"day").format("MMM D, YYYY")),1),d(b,{text:"Next",onClick:H})])]),_:1}),d(V,{class:"mt-8"},{default:Y(()=>[e("div",ie,[e("table",de,[t[2]||(t[2]=e("thead",null,[e("tr",null,[e("th",{class:"bg-gray-100 text-base font-bold text-gray-700 py-4 text-left"},"Day"),e("th",{class:"bg-gray-100 text-base font-bold text-gray-700 py-4 text-center"},[A("Morning"),e("br"),e("span",{class:"text-xs text-gray-400"},"6:00 AM - 3:00 PM")]),e("th",{class:"bg-gray-100 text-base font-bold text-gray-700 py-4 text-center"},[A("Night"),e("br"),e("span",{class:"text-xs text-gray-400"},"3:00 PM - 12:00 AM")])])],-1)),e("tbody",null,[(o(!0),i(k,null,L(B.value,(s,w)=>(o(),i("tr",{key:w,class:"border-b last:border-b-0"},[e("td",ue,[e("div",ce,[e("span",fe,f(s.format("ddd")),1),e("span",me,f(s.format("D")),1)])]),(o(),i(k,null,L([0,1],n=>e("td",{key:n,class:"py-4 px-2 align-top"},[e("div",{class:v(["w-full h-16 flex items-center justify-center rounded-lg transition text-base font-medium border-2",j(s,n)?"bg-green-200 text-green-900 border-green-300 shadow":"bg-gray-100 text-gray-400 border-gray-200 hover:bg-purple-100 hover:text-purple-700 hover:border-purple-300",m.value?"opacity-50 cursor-not-allowed":"cursor-pointer"]),onClick:u=>m.value?null:W(s,n)},[j(s,n)?(o(),i("span",ye,f(E(s,n)),1)):(o(),i("span",be,f(D[n]),1))],10,pe)])),64))]))),128))])]),e("div",ve,[d(b,{text:"Reset",onClick:K,class:v("bg-red-600 text-white px-8 py-2 rounded-lg font-semibold text-base"),disabled:m.value},null,8,["disabled"]),m.value?(o(),T(b,{key:1,text:"Assign Task",onClick:t[0]||(t[0]=s=>a.$inertia.visit(a.route("schedule.assign-task"))),class:v("bg-green-700 text-white px-8 py-2 rounded-lg font-semibold text-base")})):(o(),T(b,{key:0,text:"Submit Weekly Schedule",onClick:O,class:v("bg-purple-700 text-white px-8 py-2 rounded-lg font-semibold text-base"),disabled:m.value},null,8,["disabled"]))])])]),_:1}),d(J,{name:"fade"},{default:Y(()=>[x.value!==null&&h.value!==null&&!m.value?(o(),i("div",ge,[e("div",xe,[e("button",{onClick:C,class:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-xl font-bold",disabled:r.value},"Ã—",8,he),e("h2",_e,[A(" Assign "+f(D[h.value])+" Shift",1),t[3]||(t[3]=e("br",null,null,-1)),e("span",we,"for "+f(x.value.format("ddd, MMM D")),1)]),r.value?(o(),i("div",Ye,t[4]||(t[4]=[e("svg",{class:"animate-spin h-10 w-10 text-purple-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),e("span",{class:"text-purple-600 font-semibold text-lg"},"Validating staff...",-1)]))):(o(),i("div",ke,[t[6]||(t[6]=e("label",{class:"block text-sm font-semibold mb-2 text-gray-700"},"Select Staff",-1)),X(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>_.value=s),class:"border-2 border-purple-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 rounded-lg px-3 py-2 w-full text-base transition shadow-sm outline-none",disabled:r.value,autofocus:""},[t[5]||(t[5]=e("option",{value:""},"Select Staff",-1)),(o(!0),i(k,null,L(g.staffList,s=>(o(),i("option",{key:s.id,value:s.id},f(s.name),9,De))),128))],8,Me),[[ee,_.value]]),d(b,{text:"Assign",onClick:F,class:v("w-full bg-purple-600 text-white font-semibold py-2 rounded-lg mt-4"),disabled:r.value||!_.value},null,8,["disabled"])])),d(b,{onClick:C,text:"Cancel",class:v("w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 rounded-lg transition"),disabled:r.value},null,8,["disabled"])])])):Q("",!0)]),_:1})])])]),_:1})],64))}},Te=ae(Se,[["__scopeId","data-v-0ab4650e"]]);export{Te as default};
